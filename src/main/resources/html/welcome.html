<!DOCTYPE html>
<html>
    <head>
        <title>ChessGear</title>
        <link href="css/normalize.css" rel="stylesheet" type="text/css">
        <link href="css/style.css" rel="stylesheet" type="text/css">
        <script type="text/javascript" src="js/jquery-2.1.4.min.js"></script>
        <script type="text/javascript" src="js/js.cookie.js"></script>
    </head>
    <body>

        <div id="main-wrapper">
            <header>
                <div id="wordmark">
                    ChessGear v1.0
                </div>
                <div id="current-user">
                </div>
                <div id="nav">
                    <ul>
                        <li class="active-nav"><a href="index.html">Home</a></li>
                        <li class="inactive-nav"><a href="import.html">Import</a></li>
                        <li class="inactive-nav"><a href="#">Account</a></li>
                        <div class="clear"></div>
                    </ul>
                </div>
            </header>
            <main>
                
                <form id="login" action="login.php">
                    Username: <input type="text" id="username"><br>
                    Password: <input type="password" id="password"><br>
                    <input type="submit" id="login-button" value="log in">
                    <input type="button" id="register-button" value="register">
                </form>

            </main>

            <footer>
                &copy;ChessGear 2015
            </footer>

        </div>

    </body>

    <script type="text/javascript">
        $(document).ready(function() {
            var loggedInUser = Cookies.get('loggedInUser');
            if (loggedInUser != null) {
                $("#current-user").html(loggedInUser);
            } else {
                $("#current-user").html("Not logged in");
            }

            $("#login").submit(function (e) {
                console.log('blop');
                e.preventDefault();
                
                var loginEmail = $("#username").val();
                var loginPassword = $("#password").val();
                var postRequest = jQuery.post("/chessgear/api/login", JSON.stringify({user : loginEmail, password : loginPassword}), function (data, status) {
                    alert("Login success!" + data);
                    Cookies.set('loggedInUser', loginEmail);
                });
                postRequest.fail(function (data) {
                    alert("Login failed: " + jQuery.parseJSON(data.responseText).why);
                });
            });

            $("#register-button").click(function (e) {
                e.preventDefault();
                alert("Registering user");
                var loginEmail = $("#username").val();
                var loginPassword = $("#password").val();
                var postRequest = jQuery.post("/chessgear/api/register", JSON.stringify({user : loginEmail, password : loginPassword}), function (data, status) {
                    alert("Registration success!" + data);
                });
            });
            
        });




    </script>

</html>